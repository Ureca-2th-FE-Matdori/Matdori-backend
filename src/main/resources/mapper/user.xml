<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.uplus.matdori.category.model.dao.UserDAO">

    <!-- 특정 회원 정보 조회 -->
    <select id="getUserById" parameterType="string" resultType="com.uplus.matdori.category.model.dto.UserDTO">
        SELECT * FROM 회원정보 WHERE user_id = #{user_id}
    </select>

    <!-- 회원 등록 -->
    <insert id="insertUser" parameterType="com.uplus.matdori.category.model.dto.UserDTO">
        INSERT INTO 회원정보 (
        user_id,password
        ) VALUES (
        #{user_id}, #{password}

        )
    </insert>

    <!-- 회원정보 업데이트 (포인트 및 방문 횟수) -->
    <update id="updateUser" parameterType="com.uplus.matdori.category.model.dto.UserDTO">
        UPDATE 회원정보
        SET point = #{point}, password = #{password},
        <trim prefixOverrides=",">
            <foreach collection="categoryVisits" item="visit" index="index">
                c_${index + 1} = #{visit},
            </foreach>
        </trim>
        WHERE user_id = #{userId}
    </update>

    <!-- 특정 카테고리 방문 횟수 조회 (동적 SQL) -->
    <select id="getCategoryVisitCount" parameterType="map" resultType="int">
        SELECT ${columnName} FROM 회원정보 WHERE user_id = #{user_id}
    </select>
    
    <!-- 전체 회원 중 많은 point를 갖고 있는 상위 10명의 데이터 조회 -->
    <select id="getTopRankingUsers" resultType="com.uplus.matdori.category.model.dto.UserDTO">
    	SELECT user_id, point FROM 회원정보 ORDER BY point DESC LIMIT 10
    </select>
    
    <!-- 특정 회원의 point 랭킹 조회 -->
    <select id="getMyRanking" parameterType="java.lang.String" resultType="com.uplus.matdori.category.model.dto.MyRankingDTO">
    	SELECT user_id, ranking FROM (SELECT user_id, point, RANK() OVER (ORDER BY point DESC) AS ranking FROM 회원정보) AS sortRank WHERE user_id = #{user_id};
    </select>

</mapper>
